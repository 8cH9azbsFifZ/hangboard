name: build adocs

on:
  push:
    branches:
    - main
    #paths:
    #- backend
    #- doc
jobs:
  adoc_build:
    runs-on: ubuntu-18.04
    name: asciidoctor -D ./doc --backend=html5 -o ./index.html -a toc2 doc/Manual.adoc 
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
    # - name: Get build container
    #   id: adocbuild
    #   uses: tonynv/asciidoctor-action@master
    #   with:
    #       program: "asciidoctor -D ./doc --backend=html5 -o ./index.html doc/Manual.adoc"
    # # - name: Doxygen
    #   uses: mattnotmitt/doxygen-action@v1
    #   id: doxybuild
    #   with: 
    #       working-directory: '.'
    #       doxyfile-path: ./Doxyfile

    - name: Generating HTML from my AsyncAPI document
      uses: asyncapi/github-action-for-generator@v1
      with:
        #template: '@asyncapi/html-template@0.9.0'  #In case of template from npm, because of @ it must be in quotes
        template: '@asyncapi/html-template@0.15.4'  #In case of template from npm, because of @ it must be in quotes
        filepath: backend/asyncapi.yaml
        #parameters: baseHref=/test-experiment/ sidebarOrganization=byTags #space separated list of key/values
        output: api

    - name: Print execution time
      run: echo "Time ${{ steps.adocbuild.outputs.time }}"
    - name: Deploy docs to ghpages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        enable_jekyll: false
        allow_empty_commit: false
        force_orphan: true
        publish_branch: gh-pages
        publish_dir: ./api
        keep_files: true
