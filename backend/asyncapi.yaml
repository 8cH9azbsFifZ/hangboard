asyncapi: 2.0.0
info:
  title: Hangboard application
  version: '0.0.1'
  description: |
    Force sensing hangboard application.
    Backend communication protocol. 
  license:
    name: GPLv3
    url: 'https://www.gnu.org/licenses/gpl-3.0.en.html'
servers:
  mosquitto:
    url: mqtt://t20
    protocol: mqtt
channels:
  hangboard/workout/control:
    publish:
      summary: Control the hangboard timer.
      operationId: onControlTimer
      message:
        name: ControlTimer
        payload:
          type: object
          properties:
            command:
              type: string    # alternatvie  boolean
              description: Command.      
              pattern: '^Start .+$'     # Start, Stop, Restart
              # mosquitto_pub -h localhost -t hangboard/workout/control -m Start
  hangboard/workout/holds:
    subscribe:
      summary: Information on the currently used holds.
      operationId: GetConfiguredHolds
      message:
        name: Holds Used
        payload:
          type: object
          properties:
            left:
              type: string
              description: Left hold.
              examples: ["A1","A2"]
            right:
              type: string
              description: Right hold.
              examples: ["A7","A6"]
  hangboard/workout/setinfo:
    subscribe:
      summary: Get information on the current set.
      operationId: GetSetInfo
      message:
        name: Current Set
        payload:
          type: object
          properties:
            resttostart:
              type: integer
              minimum: 0 
              description: Rest to start time in seconds.
              example: 5
            exercise:
              type: string
              description: Exercise short description.
              examples: ["Hang","Pull Up"]
            counter:
              type: integer
              minimum: 0
              description: How long to run in seconds or how much repetitions (for pull ups).
              example: 10
            pause:
              type: integer
              minimum: 0 
              description: Pause between the exercises in seconds.
              example: 5
            reps:
              type: integer
              minimum: 0
              description: Number of exercise repetitions in this set.
              example: 3
            left:
              type: string
              description: Left hold to use.
              examples: ["A1","JUG"]
            right:
              type: string
              description: Right hold to use.
              examples: ["A7","EDGE"]
            type: 
              type: string
              description: Type of exercise.
              examples: ["Hang", "Maximum Hang", "Pull Up"]
  hangboard/workout/timerstatus:
    subscribe:
      summary: Information on the current timer status.
      operationId: GetCurrentTimerStatus
      message:
        name: Timer Status
        payload:
          type: object
          properties:
            Duration:
              type: number
              description: Timer duration in seconds.
              example: 20
            Elapsed:
              type: number
              description: Timer elapsed time in seconds.
              example: 3
            Completed:
              type: number
              description: Relative completion of the current timer - elapsed / duration.
              example: 0.8
            Countdown:
              type: number
              description: Countdown number - count every second downwards. Will be -1, when no full second crossed.
              examples: [-1, 10, 9, 8] #mosquitto_sub -h localhost -t  hangboard/workout/timerstatus
  hangboard/workout/status:
    subscribe:
      summary: Current status of the workout backend.
      operationId: GetCurrentWorkoutStatus
      message:
        name: Workout Status
        payload:
          type: object
          properties:
            Duration:
              type: string
              description: Timer duration in seconds.
              examples: ["Starting", "Cleanup"]
  hangboard/sensor/load/loadstatus:
    subscribe:
      summary: Information on the current load status including the calculated values.
      operationId: GetCurrentLoadStatus
      message:
        name: Load Status
        payload:
          type: object
          properties:
            time:
              type: integer
              description: Timestamp in seconds.
              example: 123412341234
            loadcurrent:
              type: number
              description: Current load in kg.
              example: 23.2
            loadaverage:
              type: number
              description: Average load in kg.
              example: 55.3
            loadmaximal:
              type: number
              description: Maximal load in kg.
              example: 99.2
            loadloss:
              type: number
              description: Relative loss of load - current / maximal.
              example: 0.2              
            fti:
              type: number
              description: Force Time integral
              example: 231.1                     
            rfd:
              type: number
              description: Rate of force development
              example: 12.2
            HangChangeDetected:
              type: boolean
              description: Is there a change in hang status detected?
              example: true            
            HangDetected:
              type: boolean
              description: Somebody hanging? Yes or no?
              example: false
              